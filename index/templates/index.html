{% extends '_layout.html' %}
{% load custom_filters %}

{% block content %}
    <!-- slider -->

    <div class="main-slider py-20">
        <div class="container-fluid">
            <div class="row gy-4">
                <div class="col-lg-9">
                    <div class="home-slider shadow-box">

                        <div class="slider__layer slider__layer--top" style="background-color: #000000; right: -13px; top: 20px; bottom: 20px;"></div>
                        <div class="slider__layer slider__layer--bottom" style="background-color: #000; right: -25px; top: 40px; bottom: 40px;"></div>

                        <div class="swiper homeSlider" id="">
                            <div class="swiper-wrapper">
                                {% for banner in banners %}
                                	<div class="swiper-slide">
                                        <a href="{{ banner.url }}">
                                            <img alt="" class="img-fluid" loading="lazy" src="{{ banner.image.url }}">
                                        </a>
                                    </div>
                                {% endfor %}
                            </div>

                            <div class="swiper-button-next d-lg-flex d-none"></div>
                            <div class="swiper-button-prev d-lg-flex d-none"></div>

                            <div class="swiper-pagination-bg">
                                <div>
                                    <svg fill="none" height="75" viewBox="0 0 231 75" width="231"
                                         xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M0 0C31.5006 0.949537 50.52 17.872 56.1955 26.4544L55.986 25.8011L82.4924 58.631C99.3032 79.4521 131.038 79.4521 147.849 58.6309L174.356 25.8011L174.146 26.4544C179.822 17.872 198.844 0.949537 230.349 0H0Z" fill="#FCFCFC" fill-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="swiper-pagination"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="swiper suggetMoment">
                        <div class="swiper-wrapper position-relative">
                            {% for discounted_product in discounted_products %}
                            	<div class="swiper-slide">
                                    <div class="product-box">
                                        <div class="product-timer">
                                            <div class="timer-label">
                                                <span>{{ discounted_product.discounted_percentage }}%</span>
                                            </div>
                                            <div class="timer">
                                                <div class='countdown' data-date="{{ discounted_product.discount_date }}" data-time="{{ discounted_product.discount_time }}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="product-image">
                                            <img alt="" class="img-fluid" loading="lazy"
                                                 src="{{ discounted_product.book_image.url }}">
                                        </div>
                                        <div class="product-title">
                                            <div class="title">
                                                <p class=" title-font">{{ discounted_product.book_title }}</p>
                                            </div>
                                            <div class="product-rating">
                                                <div class="number"><span class="text-muted font-12">({{ discounted_product.comments.count }}+) {{ discounted_product.average_rating }}</span></div>
                                                <div class="icon"><i class="bi bi-star-fill"></i></div>
                                            </div>
                                        </div>
                                        <div class="product-action">
                                            <div class="link">
                                                <a class="btn border-0 rounded-3 main-color-one-bg" href="{% url 'product-view' discounted_product.book_slug %}">
                                                    <i class="bi bi-basket text-white"></i>
                                                </a>
                                            </div>
                                            <div class="price">
                                                <p class="old-price">{{ discounted_product.book_price|intcomma }} </p>
                                                <p class="new-price">{{ discounted_product.discounted_price|intcomma }} <span class="font-12">تومان</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="d-flex justify-content-center">
                            <div class="swiper-progress-bar">
                                <span class="slide_progress-bar"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- /slider -->

    <!-- start shop feature -->

    <div class="shop-feature py-30">
        <div class="container-fluid">
            <div class="shop-feature-parent">
                <div class="row justify-content-center g-2 row-cols-1 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-5">

                    <div class="col">
                        <div class="shop-feature-item shadow-top">
                            <img alt="" src="/static/img/icon/box.png">
                            <h5 class="mt-2">تحویل اکسپرس</h5>
                        </div>
                    </div>

                    <div class="col">
                        <div class="shop-feature-item shadow-bottom">
                            <img alt="" src="/static/img/icon/headphone.png">
                            <h5 class="mt-2"> پشتیبانی آنلاین</h5>
                        </div>
                    </div>

                    <div class="col">
                        <div class="shop-feature-item shadow-top">
                            <img alt="" src="/static/img/icon/money.png">
                            <h5 class="mt-2"> پرداخت در محل</h5>
                        </div>
                    </div>

                    <div class="col">
                        <div class="shop-feature-item shadow-bottom">
                            <img alt="" src="/static/img/icon/safe.png">
                            <h5 class="mt-2"> ضمانت کالا</h5>
                        </div>
                    </div>

                    <div class="col">
                        <div class="shop-feature-item shadow-top">
                            <img src="/static/img/icon/seven.png" alt="">
                            <h5 class="mt-2"> هفت روز ضمانت بازگشت</h5>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- /shop feature -->

    <!-- start slider category -->

    <div class="slider-category free-swiper py-30">
        <div class="container-fluid position-relative">

            <div class="section-title">
                <div class="row gy-3 align-items-center">
                    <div class="col-sm-8">
                        <div class="section-title-title">
                            <h2 class="title-font h1 main-color-three-color">دسته بندی <span
                                    class="main-color-one-color">محصولات</span>
                            </h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="swiper cat-slider">
                <div class="swiper-wrapper">
                    {% for category in categories %}
                    	<div class="swiper-slide">
                            <a href="{% url 'search' 'all' %}?category_title={{ category.category_title }}">
                                <div class="slider-category-item">
                                    <div class="slider-category-item-title">
                                        <h6>{{ category.category_title }}</h6>
                                        <span>( {{ category.products.count }} ) محصول</span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    {% endfor %}
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </div>
    </div>

    <!-- /slider category -->

    <!-- start amazing slider -->

    <div class="amazing-slider py-6 0 my-30">
        <div class="container-fluid">
            <div class="amazing-slider-parent site-slider content-box slider-parent">
                <div class="container-fluid">
                    <div class="row align-items-center">
                        <div class="col-lg-3">
                            <div class="section-title">
                                <div class="d-flex align-items-center">
                                    <img src="/static/img/discount-bold-1.svg" alt="">
                                    <div class="nw-title ms-2">
                                        <h5 class="fw-lighter">پیشنهاد</h5>
                                        <h3 class="title-font main-color-one-color">شگفت <span
                                                class="main-color-three-color">انگیز</span></h3>
                                    </div>
                                </div>
                            </div>
                            <div class="amzming-slider-image text-center">
                                <img src="/static/img/gift-ruysa-1.jpg" alt="">
                            </div>
                        </div>
                        <div class="col-lg-9">

                            <div class="container-fluid">
                                <div class="swiper amazing-slider-sw">
                                    <div class="swiper-wrapper">

                                        {% for discounted_product in discounted_products %}
                                            <div class="swiper-slide">
                                                <div class="product-box">
                                                    <a href="{% url 'product-view' discounted_product.book_slug %}">
                                                        <div class="product-image">
                                                            <img src="{{ discounted_product.book_image.url }}" loading="lazy" alt="" class="img-fluid one-image">
                                                            <img src="{{ discounted_product.book_image.url }}" loading="lazy" alt="" class="img-fluid two-image">
                                                        </div>
                                                        <div class="product-title">
                                                            <div class="title">
                                                                <p class=" title-font">{{ discounted_product.book_title }}</p>
                                                            </div>
                                                        </div>
                                                        <div class="product-action">
                                                            <div class="link">
                                                                <button class="btn border-0 rounded-3 main-color-one-bg" href="{% url 'product-view' discounted_product.book_slug %}">
                                                                    <i class="bi bi-basket text-white"></i>
                                                                </button>
                                                            </div>
                                                            <div class="price">
                                                                <p class="old-price">{{ discounted_product.book_price|intcomma }} <span class="danger-label rounded-3 ms-2">40%</span></p>
                                                                <p class="new-price">{{ discounted_product.discount_amount|intcomma }} <span class="font-12">تومان</span></p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <div class="product-foot mt-2 border-top border-1 pt-1">
                                                        <div class="d-flex align-items-center justify-content-between">
                                                            {% if request.user.is_authenticated %}
                                                                <nav class="navbar navbar-expand">
                                                                    <ul class="navbar-nav align-items-center">
                                                                        {% if discounted_product.book_title in favorite_products %}
                                                                            <li class="nav-item">
                                                                                <a href="{% url 'remove-favorite' discounted_product.book_slug %}" class="nav-item product-box-hover-item product-box-hover-item-btn" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="حذف از علاقه مندی">
                                                                                    <i class="bi bi-heart-fill" style="color: red!important;"></i>
                                                                                </a>
                                                                            </li>
                                                                        {% else %}
                                                                            <li class="nav-item">
                                                                                <a href="{% url 'add-favorite' discounted_product.book_slug %}" class="nav-item product-box-hover-item product-box-hover-item-btn" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="اضافه کردن به علاقه مندی">
                                                                                    <i class="bi bi-heart"></i>
                                                                                </a>
                                                                            </li>
                                                                        {% endif %}
                                                                    </ul>
                                                                </nav>
                                                            {% endif %}
                                                            <div class="product-rating">
                                                                <div class="number"><span class="text-muted font-12">({{ discounted_product.comment.count }}+) {{ discounted_product.average_rating }}</span></div>
                                                                <div class="icon"><i class="bi bi-star-fill"></i></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="product-timer justify-content-center border-top pt-2 mb-0">
                                                        <div class="timer">
                                                            <div class='countdown' data-date="{{ discounted_product.discount_date }}" data-time="{{ discounted_product.discount_time }}">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}

                                    </div>
                                    <div class="swiper-button-next"></div>
                                    <div class="swiper-button-prev"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- end amazing slider -->

    <!-- start product slider -->

    {% for category in products_in_categories %}
        <div class="product-slider free-sw site-slider mt-5">
            <div class="container-fluid">

                <div class="section-title">
                    <div class="row gy-3 align-items-center">
                        <div class="col-sm-8">
                            <div class="section-title-title">
                                <h2 class="title-font h1 main-color-three-color"><span class="main-color-one-color"> {{ category.category_title }} </span>
                                </h2>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="section-title-link text-sm-end text-start">
                                <a class="btn btn-title  rounded-pill" href="{% url 'search' 'all' %}?category_title={{ category.category_title }}"> مشاهده همه</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="parent parent-two">
                <div class="container-fluid">
                    <div class="swiper pro-slider">
                        <div class="swiper-wrapper">
                            {% for product in category.products %}
                            	<div class="swiper-slide">
                                    <div class="product-box">
                                        <a href="{% url 'product-view' product.book_slug %}">
                                            <div class="product-image">
                                                <img src="{{ product.book_image.url }}" loading="lazy" alt="" class="img-fluid one-image">
                                                <img src="{{ product.book_image.url }}" loading="lazy" alt="" class="img-fluid two-image">
                                            </div>
                                            <div class="product-title">
                                                <div class="title">
                                                    <p class="text-overflow-1 title-font">{{ product.book_title }}</p>
                                                </div>
                                            </div>
                                            <div class="product-action">
                                                <div class="link">
                                                    <button class="btn border-0 rounded-3 main-color-one-bg" href="{% url 'product-view' product.book_slug %}">
                                                        <i class="bi bi-basket text-white"></i>
                                                    </button>
                                                </div>
                                                <div class="price">
                                                    {% if product.discounted_percentage %}
                                                    	<p class="old-price">{{ product.book_price|intcomma }} <span class="danger-label rounded-3 ms-2">{{ product.discounted_percentage }}%</span></p>
                                                        <p class="new-price">{{ product.discount_amount|intcomma }} <span class="font-12">تومان</span></p>
                                                    {% else %}
                                                        <p class="new-price">{{ product.book_price|intcomma }} <span class="font-12">تومان</span></p>
                                                    {% endif %}

                                                </div>
                                            </div>
                                        </a>
                                        <div class="product-foot mt-2 border-top border-1 pt-1">
                                            <div class="d-flex align-items-center justify-content-between">
                                                {% if request.user.is_authenticated %}
                                                    <nav class="navbar navbar-expand">
                                                        <ul class="navbar-nav align-items-center">
                                                            {% if product.book_title in favorite_products %}
                                                                <li class="nav-item">
                                                                    <a href="{% url 'remove-favorite' product.book_slug %}" class="nav-item product-box-hover-item product-box-hover-item-btn" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="حذف از علاقه مندی">
                                                                        <i class="bi bi-heart-fill" style="color: red!important;"></i>
                                                                    </a>
                                                                </li>
                                                            {% else %}
                                                                <li class="nav-item">
                                                                    <a href="{% url 'add-favorite' product.book_slug %}" class="nav-item product-box-hover-item product-box-hover-item-btn" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="اضافه کردن به علاقه مندی">
                                                                        <i class="bi bi-heart"></i>
                                                                    </a>
                                                                </li>
                                                            {% endif %}
                                                        </ul>
                                                    </nav>
                                                {% endif %}
                                                <div class="product-rating">
                                                    <div class="number"><span class="text-muted font-12">({{ product.comment.count }}+) {{ product.average_rating }}</span></div>
                                                    <div class="icon"><i class="bi bi-star-fill"></i></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}


    <!-- end product slider -->
{% endblock %}
